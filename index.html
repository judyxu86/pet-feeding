<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸Šé—¨å–‚å…»å°åŠ©æ‰‹ | Pet Feeding Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #f5e6ff 0%, #fff5e6 100%);
            min-height: 100vh;
            padding-bottom: 2rem;
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .input-focus:focus {
            outline: none;
            border-color: #d8b4fe;
            box-shadow: 0 0 0 3px rgba(216, 180, 254, 0.1);
        }
        .checkbox-wrapper {
            position: relative;
        }
        .checkbox-wrapper input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }
        .checkbox-wrapper label {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        .checkbox-custom {
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            margin-right: 10px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            background: white;
        }
        .checkbox-wrapper input[type="checkbox"]:checked + label .checkbox-custom {
            background: #e9d5ff;
            border-color: #a855f7;
        }
        .checkbox-wrapper input[type="checkbox"]:checked + label .checkbox-custom::after {
            content: 'âœ“';
            color: #7c3aed;
            font-weight: bold;
            font-size: 14px;
        }
        .toggle-btn {
            background: white;
            border: 2px solid #d1d5db;
            color: #374151;
            transition: all 0.2s;
            cursor: pointer;
            user-select: none;
        }
        .toggle-btn.active {
            background: #e9d5ff;
            border-color: #a855f7;
            color: #7c3aed;
        }
        .photo-preview {
            width: 100%;
            max-height: none;
            height: auto;
            object-fit: contain;
            border-radius: 12px;
        }
        .photo-preview-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 12px;
        }
        .report-card {
            background: linear-gradient(135deg, #fff9f0 0%, #fff5e6 100%);
            border: 2px solid #d8b4fe;
        }
        .pet-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: flex-start;
        }
        .pet-input-wrapper {
            flex: 1;
        }
        input, select, textarea {
            max-width: 100%;
        }
        input[type="date"], input[type="time"] {
            -webkit-appearance: none;
            appearance: none;
            background-color: white;
            min-height: 48px;
        }
        input[type="number"] {
            -webkit-appearance: none;
            -moz-appearance: textfield;
            appearance: none;
        }
        .container-padding {
            padding-left: 1rem;
            padding-right: 1rem;
        }
        .qr-container {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            display: inline-block;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e9d5ff;
            border-top-color: #a855f7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .feeding-type-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .feeding-type-row .checkbox-wrapper {
            flex-shrink: 0;
        }
        .feeding-type-row input[type="text"] {
            flex: 1;
            min-width: 100px;
            padding: 0.5rem;
            font-size: 0.875rem;
        }
        .small-photo-btn {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            border-radius: 0.75rem;
        }
        .small-photo-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
            margin-top: 0.5rem;
        }
        /* åº•éƒ¨å¯¼èˆªæ  */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-around;
            padding: 0.5rem 0;
            padding-bottom: max(0.5rem, env(safe-area-inset-bottom));
            z-index: 100;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 1rem;
            color: #9ca3af;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-item.active {
            color: #7c3aed;
        }
        .nav-item span {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }
        /* å†å²è®°å½•å¡ç‰‡ */
        .history-card {
            background: white;
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .history-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        /* æ¨¡æ¿å¡ç‰‡ */
        .template-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .template-card:hover {
            border-color: #a855f7;
        }
        .template-card.selected {
            border-color: #a855f7;
            background: #faf5ff;
        }
        body {
            padding-bottom: 5rem;
        }
        /* è¯­è¨€åˆ‡æ¢ */
        .lang-switch {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
            background: white;
            border-radius: 9999px;
            padding: 0.25rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .lang-btn {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .lang-btn.active {
            background: #7c3aed;
            color: white;
        }
    </style>
</head>
<body class="container-padding">
    <!-- è¯­è¨€åˆ‡æ¢ -->
    <div class="lang-switch">
        <button class="lang-btn active" data-lang="zh" onclick="switchLanguage('zh')">ä¸­æ–‡</button>
        <button class="lang-btn" data-lang="en" onclick="switchLanguage('en')">EN</button>
    </div>

    <!-- åŠ è½½ä¸­é®ç½© -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600" data-i18n="loading">æ­£åœ¨å¤„ç†...</p>
        </div>
    </div>

    <!-- ç™»å½•é¡µ -->
    <div id="loginPage" class="max-w-md mx-auto pt-20">
        <div class="text-center mb-8">
            <div class="text-6xl mb-4">ğŸ¾</div>
            <h1 class="text-2xl font-bold text-gray-800 mb-2" data-i18n="appTitle">ä¸Šé—¨å–‚å…»å°åŠ©æ‰‹</h1>
            <p class="text-gray-600 text-sm" data-i18n="appSubtitle">è®°å½•æ¯ä¸€æ¬¡è´´å¿ƒçš„æœåŠ¡</p>
        </div>
        <div class="bg-white rounded-2xl p-6 card-shadow">
            <h2 class="text-lg font-semibold text-gray-800 mb-4 text-center" data-i18n="staffLogin">æœåŠ¡äººå‘˜ç™»å½•</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="password">å¯†ç </label>
                    <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç "
                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                </div>
                <button onclick="doLogin()" 
                    class="w-full py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all">
                    <span data-i18n="login">ç™»å½•</span>
                </button>
                <p id="loginError" class="text-red-500 text-sm text-center hidden" data-i18n="wrongPassword">å¯†ç é”™è¯¯</p>
            </div>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨é¡µ -->
    <div id="mainApp" class="hidden">
        <!-- å¡«å†™é¡µ -->
        <div id="formPage" class="max-w-md mx-auto pt-6">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ¾ <span data-i18n="appTitle">ä¸Šé—¨å–‚å…»å°åŠ©æ‰‹</span></h1>
                <p class="text-gray-600 text-sm" data-i18n="appSubtitle">è®°å½•æ¯ä¸€æ¬¡è´´å¿ƒçš„æœåŠ¡</p>
            </div>

            <!-- é€‰æ‹©æ¨¡æ¿æç¤º -->
            <div id="templateHint" class="bg-purple-50 border border-purple-200 rounded-xl p-3 mb-4 hidden">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="mr-2">ğŸ“‹</span>
                        <span class="text-sm text-purple-700" data-i18n="usingTemplate">æ­£åœ¨ä½¿ç”¨æ¨¡æ¿ï¼š</span>
                        <span id="currentTemplateName" class="text-sm font-medium text-purple-800"></span>
                    </div>
                    <button onclick="clearTemplate()" class="text-purple-600 text-sm" data-i18n="clear">æ¸…é™¤</button>
                </div>
            </div>

            <form id="feedingForm" class="space-y-5">
                <!-- åŸºç¡€ä¿¡æ¯ -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸ“…</span> <span data-i18n="basicInfo">åŸºç¡€ä¿¡æ¯</span>
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="date">æ—¥æœŸ</label>
                            <input type="date" id="serviceDate" required
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="startTime">å¼€å§‹æ—¶é—´</label>
                                <input type="time" id="serviceStartTime" required
                                    class="w-full px-3 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="endTime">ç»“æŸæ—¶é—´</label>
                                <input type="time" id="serviceEndTime"
                                    class="w-full px-3 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="address">å®¢æˆ·åœ°å€</label>
                            <input type="text" id="customerAddress" placeholder="è¯·è¾“å…¥å®¢æˆ·åœ°å€" required
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="ownerName">ä¸»äººå§“å</label>
                            <input type="text" id="ownerName" placeholder="è¯·è¾“å…¥ä¸»äººå§“å" required
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="petName">å® ç‰©æ˜µç§°</label>
                            <div id="petNamesContainer">
                                <div class="pet-input-group mb-2">
                                    <div class="pet-input-wrapper">
                                        <input type="text" name="petName" placeholder="è¯·è¾“å…¥å® ç‰©æ˜µç§°" required
                                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                                    </div>
                                </div>
                            </div>
                            <button type="button" id="addPetBtn" 
                                class="w-full mt-2 px-4 py-2 rounded-xl border-2 border-dashed border-purple-300 text-purple-600 hover:bg-purple-50 transition-all text-sm font-medium">
                                + <span data-i18n="addPet">æ·»åŠ å® ç‰©</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- é¥®é£Ÿç…§æ–™ -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸ½ï¸</span> <span data-i18n="feeding">é¥®é£Ÿç…§æ–™</span>
                    </h2>
                    <div class="space-y-4">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="bowlCleaned">
                            <label for="bowlCleaned">
                                <span class="checkbox-custom"></span>
                                <span class="text-gray-700" data-i18n="bowlCleaned">ç²®ç¢—/æ°´ç¢—æ¸…æ´—</span>
                            </label>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3" data-i18n="feedingType">å–‚é£Ÿç±»å‹</label>
                            <div class="space-y-3">
                                <div class="feeding-type-row">
                                    <div class="checkbox-wrapper">
                                        <input type="checkbox" id="feedingTypeDry" name="feedingType" value="å¹²ç²®">
                                        <label for="feedingTypeDry">
                                            <span class="checkbox-custom"></span>
                                            <span class="text-gray-700" data-i18n="dryFood">å¹²ç²®</span>
                                        </label>
                                    </div>
                                    <input type="text" id="feedingBrandDry" placeholder="å“ç‰Œ"
                                        class="rounded-lg border-2 border-gray-200 input-focus text-gray-800 text-sm bg-white">
                                </div>
                                <div class="feeding-type-row">
                                    <div class="checkbox-wrapper">
                                        <input type="checkbox" id="feedingTypeWet" name="feedingType" value="æ¹¿ç²®">
                                        <label for="feedingTypeWet">
                                            <span class="checkbox-custom"></span>
                                            <span class="text-gray-700" data-i18n="wetFood">æ¹¿ç²®</span>
                                        </label>
                                    </div>
                                    <input type="text" id="feedingBrandWet" placeholder="å“ç‰Œ"
                                        class="rounded-lg border-2 border-gray-200 input-focus text-gray-800 text-sm bg-white">
                                </div>
                                <div class="feeding-type-row">
                                    <div class="checkbox-wrapper">
                                        <input type="checkbox" id="feedingTypeCan" name="feedingType" value="ç½å¤´">
                                        <label for="feedingTypeCan">
                                            <span class="checkbox-custom"></span>
                                            <span class="text-gray-700" data-i18n="cannedFood">ç½å¤´</span>
                                        </label>
                                    </div>
                                    <input type="text" id="feedingBrandCan" placeholder="å“ç‰Œ"
                                        class="rounded-lg border-2 border-gray-200 input-focus text-gray-800 text-sm bg-white">
                                </div>
                                <div class="feeding-type-row">
                                    <div class="checkbox-wrapper">
                                        <input type="checkbox" id="feedingTypeSnack" name="feedingType" value="é›¶é£Ÿ">
                                        <label for="feedingTypeSnack">
                                            <span class="checkbox-custom"></span>
                                            <span class="text-gray-700" data-i18n="treats">é›¶é£Ÿ</span>
                                        </label>
                                    </div>
                                    <input type="text" id="feedingBrandSnack" placeholder="å“ç‰Œ"
                                        class="rounded-lg border-2 border-gray-200 input-focus text-gray-800 text-sm bg-white">
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="feedingAmount">å–‚é£Ÿé‡</label>
                            <div class="flex gap-2 items-center">
                                <input type="number" id="feedingAmount" placeholder="æ•°é‡" min="0" step="any"
                                    class="flex-1 px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                                <select id="feedingUnit" class="px-3 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white" style="min-width: 80px;">
                                    <option value="g">g</option>
                                    <option value="ä»½">ä»½</option>
                                    <option value="åŒ…">åŒ…</option>
                                    <option value="ç½">ç½</option>
                                </select>
                            </div>
                        </div>

                        <!-- æœåŠ¡å‰è¿›é£Ÿæƒ…å†µ -->
                        <div class="bg-gray-50 rounded-xl p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-3" data-i18n="eatingBefore">æœåŠ¡å‰ï¼ˆåŸæœ‰ç²®ï¼‰è¿›é£Ÿæƒ…å†µ</label>
                            <div class="flex flex-wrap gap-2 mb-3">
                                <button type="button" class="toggle-btn px-3 py-2 rounded-xl text-sm" data-group="eatingBefore" data-value="åƒå®Œäº†" data-i18n-value="finishedAll">åƒå®Œäº†</button>
                                <button type="button" class="toggle-btn px-3 py-2 rounded-xl text-sm" data-group="eatingBefore" data-value="åƒäº†å¤§éƒ¨åˆ†" data-i18n-value="mostlyEaten">åƒäº†å¤§éƒ¨åˆ†</button>
                                <button type="button" class="toggle-btn px-3 py-2 rounded-xl text-sm" data-group="eatingBefore" data-value="åƒäº†ä¸€ç‚¹" data-i18n-value="ateALittle">åƒäº†ä¸€ç‚¹</button>
                                <button type="button" class="toggle-btn px-3 py-2 rounded-xl text-sm" data-group="eatingBefore" data-value="æ²¡æ€ä¹ˆåƒ" data-i18n-value="hardlyAte">æ²¡æ€ä¹ˆåƒ</button>
                            </div>
                            <input type="file" id="eatingBeforePhotoInput" accept="image/*" class="hidden">
                            <button type="button" class="small-photo-btn border-2 border-dashed border-purple-300 text-purple-600 hover:bg-purple-50 transition-all" onclick="document.getElementById('eatingBeforePhotoInput').click()">
                                ğŸ“· <span data-i18n="addPhoto">æ·»åŠ ç…§ç‰‡</span>
                            </button>
                            <div id="eatingBeforePhotoPreview" class="hidden">
                                <img id="eatingBeforePhoto" class="small-photo-preview">
                                <button type="button" class="text-red-500 text-xs mt-1" onclick="removePhoto('eatingBefore')" data-i18n="delete">åˆ é™¤</button>
                            </div>
                        </div>

                        <!-- æœåŠ¡æ—¶è¿›é£Ÿæƒ…å†µ -->
                        <div class="bg-gray-50 rounded-xl p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-3" data-i18n="eatingDuring">æœåŠ¡æ—¶ï¼ˆæ–°ç»™ç²®ï¼‰è¿›é£Ÿæƒ…å†µ</label>
                            <div class="flex flex-wrap gap-2 mb-3">
                                <button type="button" class="toggle-btn px-3 py-2 rounded-xl text-sm" data-group="eatingDuring" data-value="åƒå¾—å¾ˆé¦™" data-i18n-value="ateWell">åƒå¾—å¾ˆé¦™</button>
                                <button type="button" class="toggle-btn px-3 py-2 rounded-xl text-sm" data-group="eatingDuring" data-value="æ­£å¸¸è¿›é£Ÿ" data-i18n-value="normalEating">æ­£å¸¸è¿›é£Ÿ</button>
                                <button type="button" class="toggle-btn px-3 py-2 rounded-xl text-sm" data-group="eatingDuring" data-value="åƒäº†ä¸€ç‚¹" data-i18n-value="ateALittle">åƒäº†ä¸€ç‚¹</button>
                                <button type="button" class="toggle-btn px-3 py-2 rounded-xl text-sm" data-group="eatingDuring" data-value="æ²¡æ€ä¹ˆåƒ" data-i18n-value="hardlyAte">æ²¡æ€ä¹ˆåƒ</button>
                            </div>
                            <input type="file" id="eatingDuringPhotoInput" accept="image/*" class="hidden">
                            <button type="button" class="small-photo-btn border-2 border-dashed border-purple-300 text-purple-600 hover:bg-purple-50 transition-all" onclick="document.getElementById('eatingDuringPhotoInput').click()">
                                ğŸ“· <span data-i18n="addPhoto">æ·»åŠ ç…§ç‰‡</span>
                            </button>
                            <div id="eatingDuringPhotoPreview" class="hidden">
                                <img id="eatingDuringPhoto" class="small-photo-preview">
                                <button type="button" class="text-red-500 text-xs mt-1" onclick="removePhoto('eatingDuring')" data-i18n="delete">åˆ é™¤</button>
                            </div>
                        </div>

                        <!-- æ¢æ°´ -->
                        <div class="bg-gray-50 rounded-xl p-4">
                            <div class="checkbox-wrapper mb-3">
                                <input type="checkbox" id="waterChanged">
                                <label for="waterChanged">
                                    <span class="checkbox-custom"></span>
                                    <span class="text-gray-700" data-i18n="waterChanged">å·²æ¢æ°´</span>
                                </label>
                            </div>
                            <input type="file" id="waterPhotoInput" accept="image/*" class="hidden">
                            <button type="button" class="small-photo-btn border-2 border-dashed border-purple-300 text-purple-600 hover:bg-purple-50 transition-all" onclick="document.getElementById('waterPhotoInput').click()">
                                ğŸ“· <span data-i18n="waterPhoto">æ¢æ°´ç…§ç‰‡</span>
                            </button>
                            <div id="waterPhotoPreview" class="hidden">
                                <img id="waterPhoto" class="small-photo-preview">
                                <button type="button" class="text-red-500 text-xs mt-1" onclick="removePhoto('water')" data-i18n="delete">åˆ é™¤</button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="dietNotes">é¥®é£Ÿå¤‡æ³¨</label>
                            <input type="text" id="dietNotes" placeholder="å¦‚æœ‰ç‰¹æ®Šæƒ…å†µè¯·å¤‡æ³¨"
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                        </div>
                    </div>
                </div>

                <!-- å® ç‰©çŠ¶æ€ -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸ˜º</span> <span data-i18n="petStatus">å® ç‰©çŠ¶æ€</span>
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3" data-i18n="mood">ç²¾ç¥çŠ¶æ€</label>
                            <div class="flex flex-wrap gap-2">
                                <button type="button" class="toggle-btn px-4 py-2 rounded-xl text-sm" data-group="mood" data-value="æ´»æ³¼å¥½åŠ¨" data-i18n-value="active">æ´»æ³¼å¥½åŠ¨</button>
                                <button type="button" class="toggle-btn px-4 py-2 rounded-xl text-sm" data-group="mood" data-value="æ­£å¸¸" data-i18n-value="normal">æ­£å¸¸</button>
                                <button type="button" class="toggle-btn px-4 py-2 rounded-xl text-sm" data-group="mood" data-value="æ¯”è¾ƒå®‰é™" data-i18n-value="quiet">æ¯”è¾ƒå®‰é™</button>
                                <button type="button" class="toggle-btn px-4 py-2 rounded-xl text-sm" data-group="mood" data-value="çŠ¶æ€å¼‚å¸¸" data-i18n-value="abnormal">çŠ¶æ€å¼‚å¸¸</button>
                            </div>
                        </div>

                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="playInteraction">
                            <label for="playInteraction">
                                <span class="checkbox-custom"></span>
                                <span class="text-gray-700" data-i18n="playTime">é™ªç©äº’åŠ¨</span>
                            </label>
                        </div>

                        <div id="playDurationContainer" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="playDuration">é™ªç©æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</label>
                            <input type="number" id="playDuration" placeholder="è¯·è¾“å…¥åˆ†é’Ÿæ•°" min="1"
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                        </div>

                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="grooming">
                            <label for="grooming">
                                <span class="checkbox-custom"></span>
                                <span class="text-gray-700" data-i18n="grooming">æ¢³æ¯›</span>
                            </label>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="petStatusNotes">å® ç‰©çŠ¶æ€å¤‡æ³¨</label>
                            <input type="text" id="petStatusNotes" placeholder="å¦‚æœ‰ç‰¹æ®Šæƒ…å†µè¯·å¤‡æ³¨"
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                        </div>
                    </div>
                </div>

                <!-- å«ç”Ÿæ¸…æ´ -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸ’©</span> <span data-i18n="hygiene">å«ç”Ÿæ¸…æ´</span>
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3" data-i18n="poopStatus">æ’ä¾¿æƒ…å†µ</label>
                            <div class="flex flex-wrap gap-2">
                                <button type="button" class="toggle-btn px-4 py-2 rounded-xl text-sm" data-group="poop" data-value="æ­£å¸¸" data-i18n-value="normal">æ­£å¸¸</button>
                                <button type="button" class="toggle-btn px-4 py-2 rounded-xl text-sm" data-group="poop" data-value="åè½¯" data-i18n-value="soft">åè½¯</button>
                                <button type="button" class="toggle-btn px-4 py-2 rounded-xl text-sm" data-group="poop" data-value="æ‹‰ç¨€" data-i18n-value="diarrhea">æ‹‰ç¨€</button>
                                <button type="button" class="toggle-btn px-4 py-2 rounded-xl text-sm" data-group="poop" data-value="ä¾¿ç§˜" data-i18n-value="constipation">ä¾¿ç§˜</button>
                                <button type="button" class="toggle-btn px-4 py-2 rounded-xl text-sm" data-group="poop" data-value="æœªå‘ç°" data-i18n-value="notFound">æœªå‘ç°</button>
                            </div>
                        </div>

                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="poopHasHair">
                            <label for="poopHasHair">
                                <span class="checkbox-custom"></span>
                                <span class="text-gray-700" data-i18n="poopHasHair">ä¾¿ä¾¿æœ‰æ¯›å‘</span>
                            </label>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="poopNotes">æ’ä¾¿å¤‡æ³¨</label>
                            <input type="text" id="poopNotes" placeholder="å¦‚æœ‰ç‰¹æ®Šæƒ…å†µè¯·å¤‡æ³¨"
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                        </div>

                        <!-- å°¿å›¢ -->
                        <div class="bg-gray-50 rounded-xl p-4">
                            <label class="block text-sm font-medium text-gray-700 mb-3" data-i18n="urineStatus">å°¿å›¢æƒ…å†µ</label>
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1" data-i18n="urineCount">æ•°é‡</label>
                                    <input type="number" id="urineCount" placeholder="å‡ ä¸ª" min="0"
                                        class="w-full px-3 py-2 rounded-lg border-2 border-gray-200 input-focus text-gray-800 text-sm bg-white">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1" data-i18n="urineSize">å¤§å°</label>
                                    <div class="flex flex-wrap gap-1">
                                        <button type="button" class="toggle-btn px-3 py-1 rounded-lg text-xs" data-group="urineSize" data-value="æ­£å¸¸">æ­£å¸¸</button>
                                        <button type="button" class="toggle-btn px-3 py-1 rounded-lg text-xs" data-group="urineSize" data-value="åå¤§">åå¤§</button>
                                        <button type="button" class="toggle-btn px-3 py-1 rounded-lg text-xs" data-group="urineSize" data-value="åå°">åå°</button>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1" data-i18n="urineAbnormal">å°¿å›¢å¼‚å¸¸</label>
                                <div class="flex flex-wrap gap-1 mb-3">
                                    <button type="button" class="toggle-btn px-3 py-1 rounded-lg text-xs" data-group="urineAbnormal" data-value="æ— å¼‚å¸¸">æ— å¼‚å¸¸</button>
                                    <button type="button" class="toggle-btn px-3 py-1 rounded-lg text-xs" data-group="urineAbnormal" data-value="é¢œè‰²æ·±">é¢œè‰²æ·±</button>
                                    <button type="button" class="toggle-btn px-3 py-1 rounded-lg text-xs" data-group="urineAbnormal" data-value="é¢œè‰²æµ…">é¢œè‰²æµ…</button>
                                    <button type="button" class="toggle-btn px-3 py-1 rounded-lg text-xs" data-group="urineAbnormal" data-value="æœ‰è¡€ä¸">æœ‰è¡€ä¸</button>
                                    <button type="button" class="toggle-btn px-3 py-1 rounded-lg text-xs" data-group="urineAbnormal" data-value="æ°”å‘³å¼‚å¸¸">æ°”å‘³å¼‚å¸¸</button>
                                    <button type="button" class="toggle-btn px-3 py-1 rounded-lg text-xs" data-group="urineAbnormal" data-value="ç»“å—å¼‚å¸¸">ç»“å—å¼‚å¸¸</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1" data-i18n="urineNotes">å°¿å›¢å¤‡æ³¨</label>
                                <input type="text" id="urineNotes" placeholder="å¦‚æœ‰ç‰¹æ®Šæƒ…å†µè¯·å¤‡æ³¨"
                                    class="w-full px-3 py-2 rounded-lg border-2 border-gray-200 input-focus text-gray-800 text-sm bg-white">
                            </div>
                        </div>

                        <!-- æ’æ³„ç‰©ç…§ç‰‡ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="wastePhoto">æ’æ³„ç‰©ç…§ç‰‡</label>
                            <input type="file" id="wastePhotoInput" accept="image/*" class="hidden">
                            <button type="button" class="w-full px-4 py-2 rounded-xl border-2 border-dashed border-purple-300 text-purple-600 hover:bg-purple-50 transition-all text-sm" onclick="document.getElementById('wastePhotoInput').click()">
                                ğŸ“· <span data-i18n="uploadWastePhoto">ä¸Šä¼ ç²‘ç²‘/å°¿å›¢ç…§ç‰‡</span>
                            </button>
                            <div id="wastePhotoPreview" class="hidden mt-2">
                                <img id="wastePhoto" class="small-photo-preview">
                                <button type="button" class="text-red-500 text-xs mt-1" onclick="removePhoto('waste')" data-i18n="delete">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å‘•åæƒ…å†µ -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸ¤®</span> <span data-i18n="vomit">å‘•åæƒ…å†µ</span>
                    </h2>
                    <div class="space-y-4">
                        <div class="flex gap-2">
                            <button type="button" class="toggle-btn px-4 py-2 rounded-xl text-sm flex-1" data-group="vomit" data-value="æœªå‘ç°å‘•åç‰©" data-i18n-value="noVomit">æœªå‘ç°å‘•åç‰©</button>
                            <button type="button" class="toggle-btn px-4 py-2 rounded-xl text-sm flex-1" data-group="vomit" data-value="å‘ç°å‘•åç‰©" data-i18n-value="foundVomit">å‘ç°å‘•åç‰©</button>
                        </div>

                        <div id="vomitDetails" class="hidden space-y-3">
                            <label class="block text-sm font-medium text-gray-700" data-i18n="vomitType">å‘•åç‰©ç±»å‹</label>
                            <div class="space-y-2">
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="vomitTypeHairball" name="vomitType" value="æ¯›çƒ">
                                    <label for="vomitTypeHairball">
                                        <span class="checkbox-custom"></span>
                                        <span class="text-gray-700" data-i18n="hairball">æ¯›çƒ</span>
                                    </label>
                                </div>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="vomitTypeFood" name="vomitType" value="æœªæ¶ˆåŒ–çš„é£Ÿç‰©">
                                    <label for="vomitTypeFood">
                                        <span class="checkbox-custom"></span>
                                        <span class="text-gray-700" data-i18n="undigestedFood">æœªæ¶ˆåŒ–çš„é£Ÿç‰©</span>
                                    </label>
                                </div>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="vomitTypeLiquid" name="vomitType" value="æ¶²ä½“/æ³¡æ²«">
                                    <label for="vomitTypeLiquid">
                                        <span class="checkbox-custom"></span>
                                        <span class="text-gray-700" data-i18n="liquidFoam">æ¶²ä½“/æ³¡æ²«</span>
                                    </label>
                                </div>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="vomitTypeOther" name="vomitType" value="å…¶ä»–">
                                    <label for="vomitTypeOther">
                                        <span class="checkbox-custom"></span>
                                        <span class="text-gray-700" data-i18n="other">å…¶ä»–</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="vomitNotes">å‘•åå¤‡æ³¨</label>
                                <input type="text" id="vomitNotes" placeholder="æè¿°å‘•åç‰©æƒ…å†µ"
                                    class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç¯å¢ƒæ£€æŸ¥ -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸ </span> <span data-i18n="environment">ç¯å¢ƒæ£€æŸ¥</span>
                    </h2>
                    <div class="space-y-3">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="doorWindowChecked">
                            <label for="doorWindowChecked">
                                <span class="checkbox-custom"></span>
                                <span class="text-gray-700" data-i18n="doorWindowChecked">é—¨çª—å·²ç¡®è®¤é”å¥½</span>
                            </label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="utilitiesChecked">
                            <label for="utilitiesChecked">
                                <span class="checkbox-custom"></span>
                                <span class="text-gray-700" data-i18n="utilitiesChecked">æ°´ç”µ/ç©ºè°ƒå·²å¤åŸ</span>
                            </label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="surroundingCleaned">
                            <label for="surroundingCleaned">
                                <span class="checkbox-custom"></span>
                                <span class="text-gray-700" data-i18n="surroundingCleaned">å‘¨è¾¹æ¸…æ´/è¡¥ç ‚</span>
                            </label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="trashHandled">
                            <label for="trashHandled">
                                <span class="checkbox-custom"></span>
                                <span class="text-gray-700" data-i18n="trashHandled">åƒåœ¾å·²å¤„ç†</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- ç…§ç‰‡ä¸Šä¼  -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸ“·</span> <span data-i18n="photoRecord">æ‹ç…§è®°å½•</span>
                    </h2>
                    <div class="space-y-4">
                        <input type="file" id="photoInput" accept="image/*" class="hidden">
                        <button type="button" id="uploadPhotoBtn" 
                            class="w-full px-4 py-3 rounded-xl border-2 border-dashed border-purple-300 text-purple-600 hover:bg-purple-50 transition-all">
                            ğŸ“· <span data-i18n="clickToUpload">ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</span>
                        </button>
                        <div id="photoPreviewContainer" class="hidden">
                            <div class="photo-preview-container">
                                <img id="photoPreview" class="photo-preview w-full">
                            </div>
                            <button type="button" id="removePhotoBtn" class="mt-2 text-red-500 text-sm" data-i18n="deletePhoto">åˆ é™¤ç…§ç‰‡</button>
                        </div>
                    </div>
                </div>

                <!-- å¤‡æ³¨ -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">ğŸ“</span> <span data-i18n="otherNotes">å…¶ä»–å¤‡æ³¨</span>
                    </h2>
                    <textarea id="notes" rows="3" placeholder="å…¶ä»–éœ€è¦å‘ŠçŸ¥ä¸»äººçš„äº‹é¡¹..."
                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 resize-none bg-white"></textarea>
                </div>

                <!-- ä¿å­˜æ¨¡æ¿ -->
                <div class="bg-purple-50 rounded-2xl p-4">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="saveAsTemplate">
                        <label for="saveAsTemplate">
                            <span class="checkbox-custom"></span>
                            <span class="text-purple-700" data-i18n="saveAsTemplate">ä¿å­˜å®¢æˆ·ä¿¡æ¯ä¸ºæ¨¡æ¿</span>
                        </label>
                    </div>
                </div>

                <!-- æäº¤æŒ‰é’® -->
                <button type="submit" 
                    class="w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold rounded-2xl shadow-lg hover:shadow-xl transition-all active:scale-98">
                    <span data-i18n="generateReport">ç”ŸæˆæŠ¥å‘Š</span> âœ¨
                </button>
            </form>
        </div>

        <!-- æŠ¥å‘Šé¡µ -->
        <div id="reportPage" class="max-w-md mx-auto pt-6 hidden">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">ğŸ¾ <span data-i18n="feedingReport">å–‚å…»æŠ¥å‘Š</span></h1>
                <p class="text-gray-600 text-sm" data-i18n="reportGenerated">æŠ¥å‘Šå·²ç”Ÿæˆï¼Œå¯åˆ†äº«ç»™å®¢æˆ·</p>
            </div>

            <div class="report-card rounded-2xl p-5 card-shadow mb-5">
                <div class="space-y-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-600 text-sm">ğŸ“ <span data-i18n="address">åœ°å€</span></p>
                            <p id="reportAddress" class="font-medium text-gray-800"></p>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-gray-600 text-sm">ğŸ‘¤ <span data-i18n="owner">ä¸»äºº</span></p>
                            <p id="reportOwner" class="font-medium text-gray-800"></p>
                        </div>
                        <div>
                            <p class="text-gray-600 text-sm">ğŸ¾ <span data-i18n="pet">å® ç‰©</span></p>
                            <p id="reportPets" class="font-medium text-gray-800"></p>
                        </div>
                    </div>
                    <div>
                        <p class="text-gray-600 text-sm">ğŸ“… <span data-i18n="serviceTime">æœåŠ¡æ—¶é—´</span></p>
                        <p id="reportDateTime" class="font-medium text-gray-800"></p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-5 card-shadow space-y-4 mb-5">
                <div>
                    <p class="text-gray-600 text-sm mb-1">ğŸ˜º <span data-i18n="petStatus">å® ç‰©çŠ¶æ€</span></p>
                    <p id="reportMood" class="text-gray-800"></p>
                </div>
                <div>
                    <p class="text-gray-600 text-sm mb-1">ğŸ½ï¸ <span data-i18n="feeding">é¥®é£Ÿç…§æ–™</span></p>
                    <p id="reportFeeding" class="text-gray-800"></p>
                </div>
                <div>
                    <p class="text-gray-600 text-sm mb-1">ğŸ’© <span data-i18n="hygiene">å«ç”Ÿæ¸…æ´</span></p>
                    <p id="reportCleaning" class="text-gray-800"></p>
                </div>
                <div id="reportVomitContainer" class="hidden">
                    <p class="text-gray-600 text-sm mb-1">ğŸ¤® <span data-i18n="vomit">å‘•åæƒ…å†µ</span></p>
                    <p id="reportVomit" class="text-gray-800"></p>
                </div>
                <div>
                    <p class="text-gray-600 text-sm mb-1">ğŸ  <span data-i18n="environment">ç¯å¢ƒæ£€æŸ¥</span></p>
                    <p id="reportEnvironment" class="text-gray-800"></p>
                </div>
                <div id="reportNotesContainer" class="hidden">
                    <p class="text-gray-600 text-sm mb-1">ğŸ“ <span data-i18n="notes">å¤‡æ³¨</span></p>
                    <p id="reportNotes" class="text-gray-800"></p>
                </div>
                <div id="reportPhotoContainer" class="hidden">
                    <p class="text-gray-600 text-sm mb-1">ğŸ“· <span data-i18n="photo">ç…§ç‰‡</span></p>
                    <div class="photo-preview-container">
                        <img id="reportPhoto" class="photo-preview w-full mt-2">
                    </div>
                </div>
            </div>

            <!-- äºŒç»´ç åˆ†äº«åŒºåŸŸ -->
            <div class="bg-white rounded-2xl p-5 card-shadow mb-5 text-center">
                <h3 class="font-semibold text-gray-800 mb-3">ğŸ“± <span data-i18n="shareToClient">åˆ†äº«ç»™å®¢æˆ·</span></h3>
                <div class="qr-container mb-3">
                    <img id="qrcode" alt="QR Code" style="width: 200px; height: 200px;">
                </div>
                <p class="text-sm text-gray-500 mb-3" data-i18n="scanToView">å®¢æˆ·æ‰«ç å³å¯æŸ¥çœ‹æŠ¥å‘Š</p>
                <div>
                    <input type="text" id="shareLink" readonly
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 text-sm text-gray-600 bg-gray-50 mb-2">
                    <button id="copyLinkBtn" 
                        class="w-full py-2 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-200 transition-all">
                        <span data-i18n="copyLink">å¤åˆ¶é“¾æ¥</span>
                    </button>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="space-y-3">
                <button id="copyTextBtn" 
                    class="w-full py-3 bg-white border-2 border-purple-300 text-purple-700 font-medium rounded-2xl hover:bg-purple-50 transition-all">
                    ğŸ“‹ <span data-i18n="copyTextReport">å¤åˆ¶æ–‡å­—æŠ¥å‘Š</span>
                </button>
                <button id="editBtn" 
                    class="w-full py-3 bg-gray-100 text-gray-700 font-medium rounded-2xl hover:bg-gray-200 transition-all">
                    âœï¸ <span data-i18n="backToEdit">è¿”å›ç¼–è¾‘</span>
                </button>
                <button id="newReportBtn" 
                    class="w-full py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold rounded-2xl shadow-lg hover:shadow-xl transition-all">
                    ğŸ“ <span data-i18n="newReport">æ–°å»ºæŠ¥å‘Š</span>
                </button>
            </div>
        </div>

        <!-- å†å²è®°å½•é¡µ -->
        <div id="historyPage" class="max-w-md mx-auto pt-6 hidden">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">ğŸ“‹ <span data-i18n="history">å†å²è®°å½•</span></h1>
                <p class="text-gray-600 text-sm" data-i18n="viewPastReports">æŸ¥çœ‹è¿‡å»çš„æœåŠ¡è®°å½•</p>
            </div>

            <div id="historyList" class="space-y-3">
                <!-- å†å²è®°å½•ä¼šåŠ¨æ€åŠ è½½ -->
            </div>
            
            <div id="historyEmpty" class="text-center py-10 hidden">
                <div class="text-4xl mb-3">ğŸ“­</div>
                <p class="text-gray-500" data-i18n="noHistory">æš‚æ— å†å²è®°å½•</p>
            </div>

            <div id="historyLoading" class="text-center py-10">
                <div class="loading-spinner mx-auto"></div>
            </div>
        </div>

        <!-- æ¨¡æ¿é¡µ -->
        <div id="templatePage" class="max-w-md mx-auto pt-6 hidden">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">ğŸ“‹ <span data-i18n="templates">å®¢æˆ·æ¨¡æ¿</span></h1>
                <p class="text-gray-600 text-sm" data-i18n="quickFill">å¿«é€Ÿå¡«å……å®¢æˆ·ä¿¡æ¯</p>
            </div>

            <div id="templateList" class="space-y-3">
                <!-- æ¨¡æ¿ä¼šåŠ¨æ€åŠ è½½ -->
            </div>
            
            <div id="templateEmpty" class="text-center py-10 hidden">
                <div class="text-4xl mb-3">ğŸ“</div>
                <p class="text-gray-500 mb-2" data-i18n="noTemplates">æš‚æ— ä¿å­˜çš„æ¨¡æ¿</p>
                <p class="text-gray-400 text-sm" data-i18n="templateHint">å¡«å†™æŠ¥å‘Šæ—¶å‹¾é€‰"ä¿å­˜ä¸ºæ¨¡æ¿"å³å¯åˆ›å»º</p>
            </div>

            <div id="templateLoading" class="text-center py-10">
                <div class="loading-spinner mx-auto"></div>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆªæ  -->
        <div class="bottom-nav">
            <div class="nav-item active" data-page="form" onclick="switchPage('form')">
                <span>ğŸ“</span>
                <span data-i18n="navNew">æ–°å»º</span>
            </div>
            <div class="nav-item" data-page="history" onclick="switchPage('history')">
                <span>ğŸ“‹</span>
                <span data-i18n="navHistory">å†å²</span>
            </div>
            <div class="nav-item" data-page="template" onclick="switchPage('template')">
                <span>ğŸ‘¤</span>
                <span data-i18n="navTemplates">æ¨¡æ¿</span>
            </div>
        </div>
    </div>

    <script>
        // ==================== é…ç½® ====================
        const firebaseConfig = {
            apiKey: "AIzaSyDKfklrd57Ua42UG6wMo5btzCqaf_P84kM",
            authDomain: "pet-feeding-report.firebaseapp.com",
            projectId: "pet-feeding-report",
            storageBucket: "pet-feeding-report.firebasestorage.app",
            messagingSenderId: "252784779994",
            appId: "1:252784779994:web:0eeedf2387795fc62fbbe3"
        };

        // å¯†ç è®¾ç½®ï¼ˆä½ å¯ä»¥ä¿®æ”¹è¿™ä¸ªå¯†ç ï¼‰
        const STAFF_PASSWORD = "sofursogood2025";

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const BASE_URL = window.location.href.replace(/\/[^\/]*$/, '');

        // ==================== å¤šè¯­è¨€ ====================
        let currentLang = localStorage.getItem('lang') || 'zh';

        const translations = {
            zh: {
                appTitle: "ä¸Šé—¨å–‚å…»å°åŠ©æ‰‹",
                appSubtitle: "è®°å½•æ¯ä¸€æ¬¡è´´å¿ƒçš„æœåŠ¡",
                staffLogin: "æœåŠ¡äººå‘˜ç™»å½•",
                password: "å¯†ç ",
                login: "ç™»å½•",
                wrongPassword: "å¯†ç é”™è¯¯",
                loading: "æ­£åœ¨å¤„ç†...",
                basicInfo: "åŸºç¡€ä¿¡æ¯",
                date: "æ—¥æœŸ",
                startTime: "å¼€å§‹æ—¶é—´",
                endTime: "ç»“æŸæ—¶é—´",
                address: "å®¢æˆ·åœ°å€",
                ownerName: "ä¸»äººå§“å",
                petName: "å® ç‰©æ˜µç§°",
                addPet: "æ·»åŠ å® ç‰©",
                feeding: "é¥®é£Ÿç…§æ–™",
                bowlCleaned: "ç²®ç¢—/æ°´ç¢—æ¸…æ´—",
                feedingType: "å–‚é£Ÿç±»å‹",
                dryFood: "å¹²ç²®",
                wetFood: "æ¹¿ç²®",
                cannedFood: "ç½å¤´",
                treats: "é›¶é£Ÿ",
                feedingAmount: "å–‚é£Ÿé‡",
                eatingBefore: "æœåŠ¡å‰ï¼ˆåŸæœ‰ç²®ï¼‰è¿›é£Ÿæƒ…å†µ",
                eatingDuring: "æœåŠ¡æ—¶ï¼ˆæ–°ç»™ç²®ï¼‰è¿›é£Ÿæƒ…å†µ",
                waterChanged: "å·²æ¢æ°´",
                waterPhoto: "æ¢æ°´ç…§ç‰‡",
                dietNotes: "é¥®é£Ÿå¤‡æ³¨",
                petStatus: "å® ç‰©çŠ¶æ€",
                mood: "ç²¾ç¥çŠ¶æ€",
                playTime: "é™ªç©äº’åŠ¨",
                playDuration: "é™ªç©æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰",
                grooming: "æ¢³æ¯›",
                petStatusNotes: "å® ç‰©çŠ¶æ€å¤‡æ³¨",
                hygiene: "å«ç”Ÿæ¸…æ´",
                poopStatus: "æ’ä¾¿æƒ…å†µ",
                poopHasHair: "ä¾¿ä¾¿æœ‰æ¯›å‘",
                poopNotes: "æ’ä¾¿å¤‡æ³¨",
                urineStatus: "å°¿å›¢æƒ…å†µ",
                urineCount: "æ•°é‡",
                urineSize: "å¤§å°",
                urineAbnormal: "å°¿å›¢å¼‚å¸¸",
                urineNotes: "å°¿å›¢å¤‡æ³¨",
                wastePhoto: "æ’æ³„ç‰©ç…§ç‰‡",
                uploadWastePhoto: "ä¸Šä¼ ç²‘ç²‘/å°¿å›¢ç…§ç‰‡",
                vomit: "å‘•åæƒ…å†µ",
                vomitType: "å‘•åç‰©ç±»å‹",
                hairball: "æ¯›çƒ",
                undigestedFood: "æœªæ¶ˆåŒ–çš„é£Ÿç‰©",
                liquidFoam: "æ¶²ä½“/æ³¡æ²«",
                other: "å…¶ä»–",
                vomitNotes: "å‘•åå¤‡æ³¨",
                environment: "ç¯å¢ƒæ£€æŸ¥",
                doorWindowChecked: "é—¨çª—å·²ç¡®è®¤é”å¥½",
                utilitiesChecked: "æ°´ç”µ/ç©ºè°ƒå·²å¤åŸ",
                surroundingCleaned: "å‘¨è¾¹æ¸…æ´/è¡¥ç ‚",
                trashHandled: "åƒåœ¾å·²å¤„ç†",
                photoRecord: "æ‹ç…§è®°å½•",
                clickToUpload: "ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡",
                deletePhoto: "åˆ é™¤ç…§ç‰‡",
                otherNotes: "å…¶ä»–å¤‡æ³¨",
                saveAsTemplate: "ä¿å­˜å®¢æˆ·ä¿¡æ¯ä¸ºæ¨¡æ¿",
                generateReport: "ç”ŸæˆæŠ¥å‘Š",
                feedingReport: "å–‚å…»æŠ¥å‘Š",
                reportGenerated: "æŠ¥å‘Šå·²ç”Ÿæˆï¼Œå¯åˆ†äº«ç»™å®¢æˆ·",
                owner: "ä¸»äºº",
                pet: "å® ç‰©",
                serviceTime: "æœåŠ¡æ—¶é—´",
                notes: "å¤‡æ³¨",
                photo: "ç…§ç‰‡",
                shareToClient: "åˆ†äº«ç»™å®¢æˆ·",
                scanToView: "å®¢æˆ·æ‰«ç å³å¯æŸ¥çœ‹æŠ¥å‘Š",
                copyLink: "å¤åˆ¶é“¾æ¥",
                copyTextReport: "å¤åˆ¶æ–‡å­—æŠ¥å‘Š",
                backToEdit: "è¿”å›ç¼–è¾‘",
                newReport: "æ–°å»ºæŠ¥å‘Š",
                history: "å†å²è®°å½•",
                viewPastReports: "æŸ¥çœ‹è¿‡å»çš„æœåŠ¡è®°å½•",
                noHistory: "æš‚æ— å†å²è®°å½•",
                templates: "å®¢æˆ·æ¨¡æ¿",
                quickFill: "å¿«é€Ÿå¡«å……å®¢æˆ·ä¿¡æ¯",
                noTemplates: "æš‚æ— ä¿å­˜çš„æ¨¡æ¿",
                templateHint: "å¡«å†™æŠ¥å‘Šæ—¶å‹¾é€‰\"ä¿å­˜ä¸ºæ¨¡æ¿\"å³å¯åˆ›å»º",
                navNew: "æ–°å»º",
                navHistory: "å†å²",
                navTemplates: "æ¨¡æ¿",
                addPhoto: "æ·»åŠ ç…§ç‰‡",
                delete: "åˆ é™¤",
                usingTemplate: "æ­£åœ¨ä½¿ç”¨æ¨¡æ¿ï¼š",
                clear: "æ¸…é™¤",
                useTemplate: "ä½¿ç”¨",
                deleteTemplate: "åˆ é™¤",
                confirmDelete: "ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡æ¿å—ï¼Ÿ",
                confirmNewReport: "ç¡®å®šè¦æ–°å»ºæŠ¥å‘Šå—ï¼Ÿå½“å‰è¡¨å•å†…å®¹å°†è¢«æ¸…ç©ºã€‚",
                linkCopied: "é“¾æ¥å·²å¤åˆ¶ï¼",
                textCopied: "æ–‡å­—æŠ¥å‘Šå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼",
                saveFailed: "ä¿å­˜å¤±è´¥",
                copyFailed: "å¤åˆ¶å¤±è´¥"
            },
            en: {
                appTitle: "Pet Feeding Assistant",
                appSubtitle: "Record every caring service",
                staffLogin: "Staff Login",
                password: "Password",
                login: "Login",
                wrongPassword: "Wrong password",
                loading: "Processing...",
                basicInfo: "Basic Info",
                date: "Date",
                startTime: "Start Time",
                endTime: "End Time",
                address: "Address",
                ownerName: "Owner Name",
                petName: "Pet Name",
                addPet: "Add Pet",
                feeding: "Feeding",
                bowlCleaned: "Bowl Cleaned",
                feedingType: "Food Type",
                dryFood: "Dry Food",
                wetFood: "Wet Food",
                cannedFood: "Canned Food",
                treats: "Treats",
                feedingAmount: "Amount",
                eatingBefore: "Before Service (Existing Food)",
                eatingDuring: "During Service (New Food)",
                waterChanged: "Water Changed",
                waterPhoto: "Water Photo",
                dietNotes: "Diet Notes",
                petStatus: "Pet Status",
                mood: "Mood",
                playTime: "Play Time",
                playDuration: "Play Duration (min)",
                grooming: "Grooming",
                petStatusNotes: "Status Notes",
                hygiene: "Hygiene",
                poopStatus: "Poop Status",
                poopHasHair: "Hair in Poop",
                poopNotes: "Poop Notes",
                urineStatus: "Urine Status",
                urineCount: "Count",
                urineSize: "Size",
                urineAbnormal: "Abnormal",
                urineNotes: "Urine Notes",
                wastePhoto: "Waste Photo",
                uploadWastePhoto: "Upload Waste Photo",
                vomit: "Vomit",
                vomitType: "Vomit Type",
                hairball: "Hairball",
                undigestedFood: "Undigested Food",
                liquidFoam: "Liquid/Foam",
                other: "Other",
                vomitNotes: "Vomit Notes",
                environment: "Environment",
                doorWindowChecked: "Doors & Windows Locked",
                utilitiesChecked: "Utilities Restored",
                surroundingCleaned: "Area Cleaned",
                trashHandled: "Trash Handled",
                photoRecord: "Photo",
                clickToUpload: "Click to Upload",
                deletePhoto: "Delete Photo",
                otherNotes: "Other Notes",
                saveAsTemplate: "Save as Template",
                generateReport: "Generate Report",
                feedingReport: "Feeding Report",
                reportGenerated: "Report generated, share with client",
                owner: "Owner",
                pet: "Pet",
                serviceTime: "Service Time",
                notes: "Notes",
                photo: "Photo",
                shareToClient: "Share with Client",
                scanToView: "Scan to view report",
                copyLink: "Copy Link",
                copyTextReport: "Copy Text Report",
                backToEdit: "Back to Edit",
                newReport: "New Report",
                history: "History",
                viewPastReports: "View past service records",
                noHistory: "No history yet",
                templates: "Templates",
                quickFill: "Quick fill client info",
                noTemplates: "No templates saved",
                templateHint: "Check \"Save as Template\" when creating a report",
                navNew: "New",
                navHistory: "History",
                navTemplates: "Templates",
                addPhoto: "Add Photo",
                delete: "Delete",
                usingTemplate: "Using template:",
                clear: "Clear",
                useTemplate: "Use",
                deleteTemplate: "Delete",
                confirmDelete: "Delete this template?",
                confirmNewReport: "Start a new report? Current form will be cleared.",
                linkCopied: "Link copied!",
                textCopied: "Text report copied!",
                saveFailed: "Save failed",
                copyFailed: "Copy failed"
            }
        };

        function switchLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.dataset.i18n;
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
        }

        // ==================== ç™»å½• ====================
        function doLogin() {
            const password = document.getElementById('loginPassword').value;
            if (password === STAFF_PASSWORD) {
                localStorage.setItem('loggedIn', 'true');
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('loginError').classList.add('hidden');
            } else {
                document.getElementById('loginError').classList.remove('hidden');
            }
        }

        document.getElementById('loginPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') doLogin();
        });

        // ==================== ç…§ç‰‡å¤„ç† ====================
        let photos = {
            main: null,
            eatingBefore: null,
            eatingDuring: null,
            water: null,
            waste: null
        };

        function setupPhotoInput(inputId, previewId, photoId, photoKey) {
            document.getElementById(inputId).addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        photos[photoKey] = e.target.result;
                        document.getElementById(photoId).src = e.target.result;
                        document.getElementById(previewId).classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function removePhoto(photoKey) {
            photos[photoKey] = null;
            if (photoKey === 'main') {
                document.getElementById('photoPreviewContainer').classList.add('hidden');
                document.getElementById('uploadPhotoBtn').innerHTML = 'ğŸ“· <span data-i18n="clickToUpload">' + translations[currentLang].clickToUpload + '</span>';
                document.getElementById('photoInput').value = '';
            } else {
                document.getElementById(photoKey + 'PhotoPreview').classList.add('hidden');
                document.getElementById(photoKey + 'PhotoInput').value = '';
            }
        }

        // ==================== é¡µé¢åˆ‡æ¢ ====================
        function switchPage(page) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.page === page);
            });

            document.getElementById('formPage').classList.add('hidden');
            document.getElementById('reportPage').classList.add('hidden');
            document.getElementById('historyPage').classList.add('hidden');
            document.getElementById('templatePage').classList.add('hidden');

            if (page === 'form') {
                document.getElementById('formPage').classList.remove('hidden');
            } else if (page === 'history') {
                document.getElementById('historyPage').classList.remove('hidden');
                loadHistory();
            } else if (page === 'template') {
                document.getElementById('templatePage').classList.remove('hidden');
                loadTemplates();
            }

            window.scrollTo(0, 0);
        }

        // ==================== å†å²è®°å½• ====================
        async function loadHistory() {
            const listEl = document.getElementById('historyList');
            const emptyEl = document.getElementById('historyEmpty');
            const loadingEl = document.getElementById('historyLoading');

            listEl.innerHTML = '';
            emptyEl.classList.add('hidden');
            loadingEl.classList.remove('hidden');

            try {
                const snapshot = await db.collection('reports')
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .get();

                loadingEl.classList.add('hidden');

                if (snapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const dateObj = new Date(data.date);
                    const dateStr = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;
                    
                    const card = document.createElement('div');
                    card.className = 'history-card card-shadow';
                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-medium text-gray-800">${data.petNames ? data.petNames.join('ã€') : 'æœªçŸ¥'}</p>
                                <p class="text-sm text-gray-500">${data.ownerName || 'æœªçŸ¥'}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-600">${dateStr}</p>
                                <p class="text-xs text-gray-400">${data.startTime || data.time || ''}</p>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2 truncate">${data.customerAddress || ''}</p>
                    `;
                    card.onclick = () => {
                        window.open(`${BASE_URL}/view.html?id=${doc.id}`, '_blank');
                    };
                    listEl.appendChild(card);
                });
            } catch (error) {
                console.error('åŠ è½½å†å²å¤±è´¥:', error);
                loadingEl.classList.add('hidden');
            }
        }

        // ==================== æ¨¡æ¿ ====================
        let currentTemplate = null;

        async function loadTemplates() {
            const listEl = document.getElementById('templateList');
            const emptyEl = document.getElementById('templateEmpty');
            const loadingEl = document.getElementById('templateLoading');

            listEl.innerHTML = '';
            emptyEl.classList.add('hidden');
            loadingEl.classList.remove('hidden');

            try {
                const snapshot = await db.collection('templates')
                    .orderBy('createdAt', 'desc')
                    .get();

                loadingEl.classList.add('hidden');

                if (snapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                snapshot.forEach(doc => {
                    const data = doc.data();
                    
                    const card = document.createElement('div');
                    card.className = 'template-card card-shadow';
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <p class="font-medium text-gray-800">${data.petNames ? data.petNames.join('ã€') : 'æœªçŸ¥'}</p>
                                <p class="text-sm text-gray-500">${data.ownerName || 'æœªçŸ¥'}</p>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mb-3 truncate">${data.customerAddress || ''}</p>
                        <div class="flex gap-2">
                            <button class="flex-1 py-2 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium" onclick="useTemplate('${doc.id}')">${translations[currentLang].useTemplate}</button>
                            <button class="px-3 py-2 bg-red-100 text-red-600 rounded-lg text-sm" onclick="deleteTemplate('${doc.id}')">${translations[currentLang].deleteTemplate}</button>
                        </div>
                    `;
                    listEl.appendChild(card);
                });
            } catch (error) {
                console.error('åŠ è½½æ¨¡æ¿å¤±è´¥:', error);
                loadingEl.classList.add('hidden');
            }
        }

        async function useTemplate(templateId) {
            try {
                const doc = await db.collection('templates').doc(templateId).get();
                if (doc.exists) {
                    const data = doc.data();
                    currentTemplate = data;
                    
                    document.getElementById('customerAddress').value = data.customerAddress || '';
                    document.getElementById('ownerName').value = data.ownerName || '';
                    
                    // æ¸…é™¤ç°æœ‰å® ç‰©è¾“å…¥æ¡†
                    const container = document.getElementById('petNamesContainer');
                    container.innerHTML = '';
                    
                    // æ·»åŠ å® ç‰©
                    if (data.petNames && data.petNames.length > 0) {
                        data.petNames.forEach((name, index) => {
                            const group = document.createElement('div');
                            group.className = 'pet-input-group mb-2';
                            group.innerHTML = `
                                <div class="pet-input-wrapper">
                                    <input type="text" name="petName" placeholder="è¯·è¾“å…¥å® ç‰©æ˜µç§°" required value="${name}"
                                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                                </div>
                                ${index > 0 ? '<button type="button" class="remove-pet-btn px-3 py-3 rounded-xl bg-red-100 text-red-500 hover:bg-red-200 transition-all">âœ•</button>' : ''}
                            `;
                            container.appendChild(group);
                            
                            if (index > 0) {
                                group.querySelector('.remove-pet-btn').addEventListener('click', () => group.remove());
                            }
                        });
                    } else {
                        container.innerHTML = `
                            <div class="pet-input-group mb-2">
                                <div class="pet-input-wrapper">
                                    <input type="text" name="petName" placeholder="è¯·è¾“å…¥å® ç‰©æ˜µç§°" required
                                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                                </div>
                            </div>
                        `;
                    }

                    document.getElementById('templateHint').classList.remove('hidden');
                    document.getElementById('currentTemplateName').textContent = data.petNames ? data.petNames.join('ã€') : data.ownerName;
                    
                    switchPage('form');
                }
            } catch (error) {
                console.error('ä½¿ç”¨æ¨¡æ¿å¤±è´¥:', error);
            }
        }

        function clearTemplate() {
            currentTemplate = null;
            document.getElementById('templateHint').classList.add('hidden');
        }

        async function deleteTemplate(templateId) {
            if (confirm(translations[currentLang].confirmDelete)) {
                try {
                    await db.collection('templates').doc(templateId).delete();
                    loadTemplates();
                } catch (error) {
                    console.error('åˆ é™¤æ¨¡æ¿å¤±è´¥:', error);
                }
            }
        }

        // ==================== è¡¨å•å¤„ç† ====================
        function getToggleValue(group) {
            const active = document.querySelector(`.toggle-btn[data-group="${group}"].active`);
            return active ? active.dataset.value : '';
        }

        function getCheckedValues(name) {
            const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
            return Array.from(checkboxes).map(cb => cb.value);
        }

        function getFeedingTypesWithBrands() {
            const types = [];
            const typeMap = {
                'Dry': { id: 'feedingTypeDry', brandId: 'feedingBrandDry', name: 'å¹²ç²®' },
                'Wet': { id: 'feedingTypeWet', brandId: 'feedingBrandWet', name: 'æ¹¿ç²®' },
                'Can': { id: 'feedingTypeCan', brandId: 'feedingBrandCan', name: 'ç½å¤´' },
                'Snack': { id: 'feedingTypeSnack', brandId: 'feedingBrandSnack', name: 'é›¶é£Ÿ' }
            };
            
            for (const key in typeMap) {
                const checkbox = document.getElementById(typeMap[key].id);
                const brandInput = document.getElementById(typeMap[key].brandId);
                if (checkbox.checked) {
                    let typeStr = typeMap[key].name;
                    if (brandInput.value.trim()) {
                        typeStr += `(${brandInput.value.trim()})`;
                    }
                    types.push(typeStr);
                }
            }
            return types;
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function generateQRCode(url) {
            const qrImg = document.getElementById('qrcode');
            const encodedUrl = encodeURIComponent(url);
            qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodedUrl}`;
        }

        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            if (localStorage.getItem('loggedIn') === 'true') {
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
            }

            // è®¾ç½®è¯­è¨€
            switchLanguage(currentLang);

            // è®¾ç½®é»˜è®¤æ—¥æœŸæ—¶é—´
            document.getElementById('serviceDate').valueAsDate = new Date();
            const now = new Date();
            document.getElementById('serviceStartTime').value = 
                now.getHours().toString().padStart(2, '0') + ':' + 
                now.getMinutes().toString().padStart(2, '0');

            // è®¾ç½®ç…§ç‰‡è¾“å…¥
            setupPhotoInput('eatingBeforePhotoInput', 'eatingBeforePhotoPreview', 'eatingBeforePhoto', 'eatingBefore');
            setupPhotoInput('eatingDuringPhotoInput', 'eatingDuringPhotoPreview', 'eatingDuringPhoto', 'eatingDuring');
            setupPhotoInput('waterPhotoInput', 'waterPhotoPreview', 'waterPhoto', 'water');
            setupPhotoInput('wastePhotoInput', 'wastePhotoPreview', 'wastePhoto', 'waste');

            // ä¸»ç…§ç‰‡ä¸Šä¼ 
            document.getElementById('uploadPhotoBtn').addEventListener('click', function() {
                document.getElementById('photoInput').click();
            });

            document.getElementById('photoInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        photos.main = e.target.result;
                        document.getElementById('photoPreview').src = photos.main;
                        document.getElementById('photoPreviewContainer').classList.remove('hidden');
                        document.getElementById('uploadPhotoBtn').innerHTML = 'ğŸ“· æ›´æ¢ç…§ç‰‡';
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.getElementById('removePhotoBtn').addEventListener('click', function() {
                removePhoto('main');
            });

            // æ·»åŠ å® ç‰©
            document.getElementById('addPetBtn').addEventListener('click', function() {
                const container = document.getElementById('petNamesContainer');
                const newGroup = document.createElement('div');
                newGroup.className = 'pet-input-group mb-2';
                newGroup.innerHTML = `
                    <div class="pet-input-wrapper">
                        <input type="text" name="petName" placeholder="è¯·è¾“å…¥å® ç‰©æ˜µç§°" required
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                    </div>
                    <button type="button" class="remove-pet-btn px-3 py-3 rounded-xl bg-red-100 text-red-500 hover:bg-red-200 transition-all">
                        âœ•
                    </button>
                `;
                container.appendChild(newGroup);
                newGroup.querySelector('.remove-pet-btn').addEventListener('click', function() {
                    newGroup.remove();
                });
            });

            // ToggleæŒ‰é’®
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const group = this.dataset.group;
                    const wasActive = this.classList.contains('active');
                    
                    document.querySelectorAll(`.toggle-btn[data-group="${group}"]`).forEach(b => {
                        b.classList.remove('active');
                    });
                    
                    if (!wasActive) {
                        this.classList.add('active');
                    }

                    if (group === 'vomit') {
                        const vomitDetails = document.getElementById('vomitDetails');
                        const isVomitFound = document.querySelector('.toggle-btn[data-group="vomit"][data-value="å‘ç°å‘•åç‰©"]').classList.contains('active');
                        vomitDetails.classList.toggle('hidden', !isVomitFound);
                    }
                });
            });

            // é™ªç©æ—¶é•¿
            document.getElementById('playInteraction').addEventListener('change', function() {
                document.getElementById('playDurationContainer').classList.toggle('hidden', !this.checked);
            });

            // è¡¨å•æäº¤
            document.getElementById('feedingForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                showLoading();

                const petNameInputs = document.querySelectorAll('input[name="petName"]');
                const petNames = Array.from(petNameInputs).map(input => input.value).filter(name => name.trim());

                const formData = {
                    date: document.getElementById('serviceDate').value,
                    startTime: document.getElementById('serviceStartTime').value,
                    endTime: document.getElementById('serviceEndTime').value,
                    customerAddress: document.getElementById('customerAddress').value,
                    ownerName: document.getElementById('ownerName').value,
                    petNames: petNames,
                    bowlCleaned: document.getElementById('bowlCleaned').checked,
                    feedingTypes: getFeedingTypesWithBrands(),
                    feedingAmount: document.getElementById('feedingAmount').value,
                    feedingUnit: document.getElementById('feedingUnit').value,
                    eatingBefore: getToggleValue('eatingBefore'),
                    eatingBeforePhoto: photos.eatingBefore,
                    eatingDuring: getToggleValue('eatingDuring'),
                    eatingDuringPhoto: photos.eatingDuring,
                    waterChanged: document.getElementById('waterChanged').checked,
                    waterPhoto: photos.water,
                    dietNotes: document.getElementById('dietNotes').value,
                    moodStatus: getToggleValue('mood'),
                    playInteraction: document.getElementById('playInteraction').checked,
                    playDuration: document.getElementById('playDuration').value,
                    grooming: document.getElementById('grooming').checked,
                    petStatusNotes: document.getElementById('petStatusNotes').value,
                    poopStatus: getToggleValue('poop'),
                    poopHasHair: document.getElementById('poopHasHair').checked,
                    poopNotes: document.getElementById('poopNotes').value,
                    urineCount: document.getElementById('urineCount').value,
                    urineSize: getToggleValue('urineSize'),
                    urineAbnormal: getToggleValue('urineAbnormal'),
                    urineNotes: document.getElementById('urineNotes').value,
                    wastePhoto: photos.waste,
                    vomitStatus: getToggleValue('vomit'),
                    vomitTypes: getCheckedValues('vomitType'),
                    vomitNotes: document.getElementById('vomitNotes').value,
                    doorWindowChecked: document.getElementById('doorWindowChecked').checked,
                    utilitiesChecked: document.getElementById('utilitiesChecked').checked,
                    surroundingCleaned: document.getElementById('surroundingCleaned').checked,
                    trashHandled: document.getElementById('trashHandled').checked,
                    photo: photos.main,
                    notes: document.getElementById('notes').value,
                    createdAt: new Date().toISOString()
                };

                try {
                    // ä¿å­˜æŠ¥å‘Š
                    const docRef = await db.collection('reports').add(formData);
                    const reportId = docRef.id;

                    // ä¿å­˜æ¨¡æ¿
                    if (document.getElementById('saveAsTemplate').checked) {
                        await db.collection('templates').add({
                            customerAddress: formData.customerAddress,
                            ownerName: formData.ownerName,
                            petNames: formData.petNames,
                            createdAt: new Date().toISOString()
                        });
                    }

                    // ç”Ÿæˆåˆ†äº«é“¾æ¥
                    const shareUrl = `${BASE_URL}/view.html?id=${reportId}`;
                    document.getElementById('shareLink').value = shareUrl;

                    try {
                        generateQRCode(shareUrl);
                    } catch (qrError) {
                        console.log('QR generation failed');
                    }

                    // æ›´æ–°æŠ¥å‘Šæ˜¾ç¤º
                    document.getElementById('reportAddress').textContent = formData.customerAddress;
                    document.getElementById('reportOwner').textContent = formData.ownerName;
                    document.getElementById('reportPets').textContent = formData.petNames.join('ã€');
                    
                    let timeStr = formData.startTime;
                    if (formData.endTime) timeStr += ` - ${formData.endTime}`;
                    const dateObj = new Date(formData.date);
                    document.getElementById('reportDateTime').textContent = `${dateObj.getFullYear()}/${dateObj.getMonth() + 1}/${dateObj.getDate()} ${timeStr}`;
                    
                    document.getElementById('reportMood').textContent = formData.moodStatus || 'æœªè®°å½•';
                    
                    let feedingParts = [];
                    if (formData.feedingTypes.length > 0) feedingParts.push(formData.feedingTypes.join('ã€'));
                    if (formData.feedingAmount) feedingParts.push(`${formData.feedingAmount}${formData.feedingUnit}`);
                    if (formData.eatingDuring) feedingParts.push(formData.eatingDuring);
                    if (formData.waterChanged) feedingParts.push('å·²æ¢æ°´');
                    document.getElementById('reportFeeding').textContent = feedingParts.join(' | ') || 'æœªå¡«å†™';
                    
                    let cleaningParts = [];
                    if (formData.poopStatus) cleaningParts.push(`æ’ä¾¿ï¼š${formData.poopStatus}`);
                    if (formData.urineCount) cleaningParts.push(`å°¿å›¢ï¼š${formData.urineCount}ä¸ª`);
                    document.getElementById('reportCleaning').textContent = cleaningParts.join(' | ') || 'æœªå¡«å†™';
                    
                    let envParts = [];
                    if (formData.doorWindowChecked) envParts.push('é—¨çª—âœ“');
                    if (formData.utilitiesChecked) envParts.push('æ°´ç”µâœ“');
                    if (formData.surroundingCleaned) envParts.push('æ¸…æ´âœ“');
                    if (formData.trashHandled) envParts.push('åƒåœ¾âœ“');
                    document.getElementById('reportEnvironment').textContent = envParts.join(' | ') || 'æœªæ£€æŸ¥';

                    if (formData.vomitStatus === 'å‘ç°å‘•åç‰©') {
                        document.getElementById('reportVomit').textContent = 'å‘ç°å‘•åç‰©';
                        document.getElementById('reportVomitContainer').classList.remove('hidden');
                    } else {
                        document.getElementById('reportVomitContainer').classList.add('hidden');
                    }

                    if (formData.notes) {
                        document.getElementById('reportNotes').textContent = formData.notes;
                        document.getElementById('reportNotesContainer').classList.remove('hidden');
                    } else {
                        document.getElementById('reportNotesContainer').classList.add('hidden');
                    }

                    if (formData.photo) {
                        document.getElementById('reportPhoto').src = formData.photo;
                        document.getElementById('reportPhotoContainer').classList.remove('hidden');
                    } else {
                        document.getElementById('reportPhotoContainer').classList.add('hidden');
                    }

                    window.reportData = formData;
                    window.reportId = reportId;

                    document.getElementById('formPage').classList.add('hidden');
                    document.getElementById('reportPage').classList.remove('hidden');
                    window.scrollTo(0, 0);

                } catch (error) {
                    console.error('ä¿å­˜å¤±è´¥:', error);
                    alert(translations[currentLang].saveFailed + ': ' + error.message);
                } finally {
                    hideLoading();
                }
            });

            // å¤åˆ¶é“¾æ¥
            document.getElementById('copyLinkBtn').addEventListener('click', function() {
                const linkInput = document.getElementById('shareLink');
                linkInput.select();
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(linkInput.value).then(() => {
                        alert('âœ… ' + translations[currentLang].linkCopied);
                    }).catch(() => {
                        document.execCommand('copy');
                        alert('âœ… ' + translations[currentLang].linkCopied);
                    });
                } else {
                    document.execCommand('copy');
                    alert('âœ… ' + translations[currentLang].linkCopied);
                }
            });

            // å¤åˆ¶æ–‡å­—æŠ¥å‘Š
            document.getElementById('copyTextBtn').addEventListener('click', function() {
                const data = window.reportData;
                const dateObj = new Date(data.date);
                let timeStr = data.startTime;
                if (data.endTime) timeStr += ` - ${data.endTime}`;
                
                let text = `ã€${translations[currentLang].feedingReport}ã€‘\n`;
                text += `ğŸ“ ${data.customerAddress}\n`;
                text += `ğŸ‘¤ ${data.ownerName}\n`;
                text += `ğŸ¾ ${data.petNames.join('ã€')}\n`;
                text += `ğŸ“… ${dateObj.getFullYear()}/${dateObj.getMonth() + 1}/${dateObj.getDate()} ${timeStr}\n\n`;
                
                text += `ğŸ˜º ${translations[currentLang].petStatus}: ${data.moodStatus || '-'}\n`;
                if (data.feedingTypes.length > 0) text += `ğŸ½ï¸ ${translations[currentLang].feeding}: ${data.feedingTypes.join('ã€')}\n`;
                if (data.feedingAmount) text += `   ${data.feedingAmount}${data.feedingUnit}\n`;
                if (data.waterChanged) text += `ğŸ’§ ${translations[currentLang].waterChanged} âœ“\n`;
                if (data.poopStatus) text += `ğŸ’© ${data.poopStatus}\n`;
                if (data.urineCount) text += `   å°¿å›¢: ${data.urineCount}ä¸ª\n`;
                if (data.doorWindowChecked) text += `ğŸ  ${translations[currentLang].doorWindowChecked} âœ“\n`;
                if (data.notes) text += `\nğŸ“ ${data.notes}`;
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => {
                        alert('âœ… ' + translations[currentLang].textCopied);
                    });
                } else {
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    alert('âœ… ' + translations[currentLang].textCopied);
                }
            });

            // è¿”å›ç¼–è¾‘
            document.getElementById('editBtn').addEventListener('click', function() {
                document.getElementById('formPage').classList.remove('hidden');
                document.getElementById('reportPage').classList.add('hidden');
                window.scrollTo(0, 0);
            });

            // æ–°å»ºæŠ¥å‘Š
            document.getElementById('newReportBtn').addEventListener('click', function() {
                if (confirm(translations[currentLang].confirmNewReport)) {
                    document.getElementById('feedingForm').reset();
                    document.getElementById('serviceDate').valueAsDate = new Date();
                    const now = new Date();
                    document.getElementById('serviceStartTime').value = 
                        now.getHours().toString().padStart(2, '0') + ':' + 
                        now.getMinutes().toString().padStart(2, '0');
                    
                    const container = document.getElementById('petNamesContainer');
                    container.innerHTML = `
                        <div class="pet-input-group mb-2">
                            <div class="pet-input-wrapper">
                                <input type="text" name="petName" placeholder="è¯·è¾“å…¥å® ç‰©æ˜µç§°" required
                                    class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus text-gray-800 bg-white">
                            </div>
                        </div>
                    `;
                    
                    document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
                    
                    photos = { main: null, eatingBefore: null, eatingDuring: null, water: null, waste: null };
                    document.getElementById('photoPreviewContainer').classList.add('hidden');
                    document.getElementById('eatingBeforePhotoPreview').classList.add('hidden');
                    document.getElementById('eatingDuringPhotoPreview').classList.add('hidden');
                    document.getElementById('waterPhotoPreview').classList.add('hidden');
                    document.getElementById('wastePhotoPreview').classList.add('hidden');
                    
                    document.getElementById('vomitDetails').classList.add('hidden');
                    document.getElementById('playDurationContainer').classList.add('hidden');
                    document.getElementById('templateHint').classList.add('hidden');
                    currentTemplate = null;
                    
                    document.getElementById('formPage').classList.remove('hidden');
                    document.getElementById('reportPage').classList.add('hidden');
                    window.scrollTo(0, 0);
                }
            });
        });
    </script>
</body>
</html>
